@* Pagination Component *@

<div class="table-pagination">
    <div class="showing-entries">
        Showing @FromEntry to @ToEntry of @TotalItems entries
    </div>
    <div class="pagination-controls">
        <button class="page-btn" disabled="@(CurrentPage == 1)" @onclick="() => OnPageChanged(1)">
            <i class="bi bi-chevron-double-left"></i>
        </button>
        <button class="page-btn" disabled="@(CurrentPage == 1)" @onclick="() => OnPageChanged(CurrentPage - 1)">
            <i class="bi bi-chevron-left"></i>
        </button>

        @foreach (var pageNum in GetPageNumbers())
        {
            <button class="page-btn @(pageNum == CurrentPage ? "active" : "")" @onclick="() => OnPageChanged(pageNum)">
                @pageNum
            </button>
        }

        <button class="page-btn" disabled="@(CurrentPage == TotalPages)" @onclick="() => OnPageChanged(CurrentPage + 1)">
            <i class="bi bi-chevron-right"></i>
        </button>
        <button class="page-btn" disabled="@(CurrentPage == TotalPages)" @onclick="() => OnPageChanged(TotalPages)">
            <i class="bi bi-chevron-double-right"></i>
        </button>
    </div>
    <div class="page-size-selector">
        <label>
            Show
            <select class="form-select form-select-sm" @onchange="OnPageSizeChanged">
                @foreach (var size in PageSizeOptions)
                {
                    <option value="@size" selected="@(size == PageSize)">@size</option>
                }
            </select>
            entries
        </label>
    </div>
</div>

@code {
    [Parameter] public int CurrentPage { get; set; } = 1;
    [Parameter] public int PageSize { get; set; } = 10;
    [Parameter] public int TotalItems { get; set; }
    [Parameter] public EventCallback<int> OnPageChange { get; set; }
    [Parameter] public EventCallback<int> OnPageSizeChange { get; set; }
    [Parameter] public int[] PageSizeOptions { get; set; } = new[] { 5, 10, 25, 50, 100 };

    private int TotalPages => (int)Math.Ceiling((double)TotalItems / PageSize);
    private int FromEntry => TotalItems == 0 ? 0 : (CurrentPage - 1) * PageSize + 1;
    private int ToEntry => Math.Min(CurrentPage * PageSize, TotalItems);

    private async Task OnPageChanged(int newPage)
    {
        if (newPage >= 1 && newPage <= TotalPages)
        {
            await OnPageChange.InvokeAsync(newPage);
        }
    }

    private async Task OnPageSizeChanged(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out int newSize))
        {
            await OnPageSizeChange.InvokeAsync(newSize);
        }
    }

    private List<int> GetPageNumbers()
    {
        var pages = new List<int>();
        var maxPagesToShow = 5;
        var halfRange = maxPagesToShow / 2;

        var startPage = Math.Max(1, CurrentPage - halfRange);
        var endPage = Math.Min(TotalPages, startPage + maxPagesToShow - 1);

        if (endPage - startPage < maxPagesToShow - 1)
        {
            startPage = Math.Max(1, endPage - maxPagesToShow + 1);
        }

        for (int i = startPage; i <= endPage; i++)
        {
            pages.Add(i);
        }

        return pages;
    }
}

